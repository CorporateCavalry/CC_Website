{% include class-info.html %}
{% include button.html id="leave_class" function="leaveClass" label="Leave Class" %}
{% include alert-message.html id="my_class" type="warning" %}

<script>
	(function() {
		if (!loginManager.isStudent() || !loginManager.isPropertyNonEmpty("ClassCode")) {
			goToPageSafe("/");
			return;
		}

		let printer = getAlertPrinter("my_class");
		printer("");

		studentCommands.getMyClassData(
			classCommands.classInfoAttributes(),
			function(classData) { // found class code
				classCommands.initializeClassInfo(classData);
				if (classCommands.getClassStatus(classData)["Status"] == "unstarted") {
					$("#button_leave_class").css("display", "");
				} else {
					$("#button_leave_class").css("display", "none");
				}
			},
			function() { // no class code
				goToPageSafe("/");
				return;
			},
			function(msg) { // error
				printer(msg);
				classCommands.hideClassInfo();
			}
		);
	})();

	function leaveClass() {
		studentCommands.leaveClass(
			function() { // successfully left the class
				goToPageSafe("/");
			},
			getAlertPrinter("my_class")
		);
	}
</script>
