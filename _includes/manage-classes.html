<div class="prof_logged_in">
	<div class="section-header">Manage Classes</div>
	<ul id="manage_classes_list" class="class-element-list">
	</ul>
	{% include alert-message.html id="manage_classes" type="error" %}

	{% include button.html label="Create New" id="goto_create_class" function="goToCreateNewClass" %}
</div>

<script>
	function goToCreateNewClass() {
		goToPageSafe("/createclass");
	}

	(function(){
		let classList = null;
		let classElementTemplate = null;

		let printer = getAlertPrinter("manage_classes")
		printer("");

		function initClassElementTemplate(newTemplate) {
			classElementTemplate = newTemplate;

			if (classList !== null) {
				displayClassData();
			}
		}

		function initClassList(newList) {
			classList = newList;

			if (classElementTemplate !== null) {
				displayClassData();
			}
		}

		function displayClassData() {
			const generateClassElementHTML = function(classData) {
				const code = classData["ClassCode"];
				const statusData = classCommands.getClassStatus(classData);

				let html = classElementTemplate;
				html = html.replaceAll("[code]", code);
				html = html.replaceAll("[status]", statusData["Status"]);
				html = html.replaceAll("[studentCount]", "x"); //TODO: replace with student count
				html = html.replaceAll("[statusMessage]", statusData["Message"]);

				return html;
			}

			const len = classList.length;
			if (len > 0) {
				const list = document.getElementById("manage_classes_list");
				list.innerHTML = ""; // clear anything inside of it

				let newElement;

				for (let i = 0; i < len; i++) {
					newElement = document.createElement("li");
					newElement.innerHTML = generateClassElementHTML(classList[i]);
					list.appendChild(newElement);
				}
			}
		}

		$.ajax({
            url: "/templates/class_element.html",
            async: true,
            success: initClassElementTemplate,
			error: function(xhr, ajaxOptions, thrownError) {
				printer("Could not load intro statement.");
			}
        });

		document.addEventListener("DOMContentLoaded", function(event) {
			if (loginManager.isProfessor()) {
				profCommands.getClassList(initClassList, printer);
			}
		});
	})();
</script>
